#  ОБЪЕДИНЕНИЕ ТАБЛИЦ – JOIN
## Таблицы для задач  

  **installs** — содержит данные об установках приложения по дням.  
- **_DeviceID_** — идентификатор устройства, на которое было установлено приложение;  
- **_InstallationDate_** — дата установки приложения;  
- **_InstallCost_** — цена установки приложения в рублях;  
- **_Platform_** — платформа, на которой было установлено приложение (iOS/ Android);  
- **_Source_** — источник установки приложения (магазин приложения/ рекламная система/ переход с сайта).  

**events** — содержит данные о том, как активно пользователи просматривают товары в приложении по дням.  
- **_DeviceID_** — идентификатор устройства, на котором используется приложение;  
- **_AppPlatform_** — платформа, на которой используется приложение (iOS/ Android);  
- **_EventDate_** — дата, за которую собрана статистика;  
- **_events_** — количество просмотров всех товаров за этот день у этого DeviceID.  

 **checks** — содержит данные о покупках пользователей в приложении по дням  
- **_UserID_** — идентификатор пользователя;  
- **_Rub_** — суммарный чек пользователя на дату;  
- **_BuyDate_** — дата, за которую собрана статистика.  

**devices** — содержит информацию как об идентификаторах пользователей, так и их устройствах  
- **_DeviceID_** — идентификатор устройства;  
- **_UserID_** — идентификатор пользователя  

Особенность приложения заключается в том, что для просмотра товаров не обязательно авторизовываться. До момента авторизации про пользователя известен только его DeviceID — идентификатор устройства. При этом для совершения покупки логин обязателен. На моменте авторизации пользователю присваивается UserID, и тогда мы уже знаем два его идентификатора: DeviceID (устройство) и UserID (логин). Так как на этапах установки приложения и просмотра каталога пользователь еще может быть не авторизован, там мы сохраняем только DeviceID. Но так как покупки нельзя совершить без авторизации, то покупки сохраняются только с UserID. Для того чтобы просмотры и установки можно было объединить с покупками, нам нужна таблица соответствия DeviceID к UserID, то есть таблица devices  
__________
*У пользователя может быть два идентификатора – UserID и DeviceID. В таблице checks есть только UserID, в остальных – только DeviceID. Во вспомогательной таблице devices есть и UserID, и DeviceID.  Давайте с помощью JOIN дополним таблицу events (left) данными о UserID пользователей из таблицы devices (right). Для некоторых DeviceID не будет пары UserID из таблицы devices – подумайте, какой вид JOIN подойдет, чтобы не потерять те строки, где DeviceID есть в events, но нет в devices.  Укажите UserID из первой строки результирующей таблицы, используя сортировку по убыванию по полю DeviceID.*

![image](https://github.com/darina6688/SQL/assets/152012358/64106743-be5b-4a5a-b586-13b72b9ad375)
___________________
*пользователи пришедшие из какого источника совершили наибольшее число покупок. В качестве ответа выберите название Source, юзеры которого совершили больше всего покупок.  Для этого используйте UserID, DeviceID и Source из соответствующих таблиц. Считать уникальные значения здесь не нужно. Также заметьте, что покупки со стоимостью 0 рублей всё ещё считаются покупками.*

 ![image](https://github.com/darina6688/SQL/assets/152012358/21888597-0bdc-4b43-b8f9-9c5104d878cb)
____________________    
*Теперь выясним, сколько всего уникальных юзеров что-то купили в нашем приложении. Объедините нужные таблицы, посчитайте число уникальных UserID для каждого источника (Source), и в качестве ответа укажите число пользователей, пришедших из Source_7*

![image](https://github.com/darina6688/SQL/assets/152012358/32b0c855-f661-4406-86f7-51f3810f5520)
_____________________
*Самое время посмотреть на общую выручку, а также минимальный, максимальный и средний чек*   

![image](https://github.com/darina6688/SQL/assets/152012358/6d75492a-9821-4926-84f2-ec6fccd28a99)
_______________________
*Выведите идентификаторы устройств пользователей, которые совершили как минимум одну покупку за последний месяц (октябрь 2019). Используйте сортировку по возрастанию DeviceID и укажите минимальное значение. Hint: для извлечения месяца из даты можно использовать toMonth() или  toStartOfMonth(), предварительно приведя BuyDate к типу date.*

![image](https://github.com/darina6688/SQL/assets/152012358/d1ab7d90-1ff2-4394-813d-b8c2e8be2aa2)
_______________________
*Проверим, сколько товаров (events) в среднем просматривают пользователи с разных платформ (Platform), и пришедшие из разных источников  (Source). Для этого объедините таблицы events и installs, и посчитайте, сколько просмотров в среднем приходится на каждую пару платформа-канал привлечения. Отсортируйте полученную табличку по убыванию среднего числа просмотров. В качестве ответа укажите платформу и источник, пользователи которого в среднем просматривали товары бóльшее число раз.*

![image](https://github.com/darina6688/SQL/assets/152012358/554d8315-ff64-41b1-a2bb-46b8e61c6dc7)
_____________________________
*Давайте посчитаем число уникальных DeviceID в инсталлах, для которых присутствуют просмотры в таблице events с разбивкой по платформам (поле Platform). Для этого можно отобрать все строки только из таблицы installs, для которых нашлось соответствие в таблице events. В качестве ответа введите число инсталлов, для которых нашлись просмотры, на платформе android.
Внимание! "Нашлось 0 просмотров" тоже считается как "нашлись просмотры". Главное, чтобы не было именно пропуска.*

![image](https://github.com/darina6688/SQL/assets/152012358/75049b27-0815-4bf3-99ff-ec83637c3172)
_________________________________
*Давайте теперь посчитаем конверсию из инсталла в просмотр с разбивкой по платформе инсталла – в данном случае это доля DeviceID, для которых есть просмотры, от всех DeviceID в инсталлах. Для этого нужно объединить таблицы installs и events так, чтобы получить все DeviceID инсталлов и соответствующие им DeviceID из events, посчитать число уникальных DeviceID инсталлов (1) и соответствующих DeviceID из events (2) и вычислить долю (2) от (1). В качестве ответа укажите значение конверсии из инсталла в просмотр на платформе ios.*

![image](https://github.com/darina6688/SQL/assets/152012358/d60698ac-82cd-4360-b367-66d738a9a1e7)
___________________________
