# –û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–î–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –∞–≤–æ–∫–∞–¥–æ ü•ë  
**_–ò–º–µ–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞:_**   

- **_date_** ‚Äì –¥–∞—Ç–∞
- **_average_price_** ‚Äì —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –æ–¥–Ω–æ–≥–æ –∞–≤–æ–∫–∞–¥–æ
- **_total_volume_** ‚Äì  –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∞–≤–æ–∫–∞–¥–æ
- **_plu4046_** ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∞–≤–æ–∫–∞–¥–æ PLU* 4046
- **_plu4225_** ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∞–≤–æ–∫–∞–¥–æ PLU 4225
- **_plu4770_** ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∞–≤–æ–∫–∞–¥–æ PLU 4770
- **_total_bags_** ‚Äì –≤—Å–µ–≥–æ —É–ø–∞–∫–æ–≤–æ–∫
- **_small_bags_** ‚Äì –º–∞–ª–µ–Ω—å–∫–∏–µ —É–ø–∞–∫–æ–≤–∫–∏
- **_large_bags_** ‚Äì –±–æ–ª—å—à–∏–µ
- **_xlarge_bags_** ‚Äì –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ
- **_type_** ‚Äì –æ–±—ã—á–Ω—ã–π –∏–ª–∏ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π
- **_year_** ‚Äì –≥–æ–¥
- **_region_** ‚Äì –≥–æ—Ä–æ–¥ –∏–ª–∏ —Ä–µ–≥–∏–æ–Ω (TotalUS ‚Äì —Å—Ä–∞–∑—É –ø–æ –°–®–ê)

–í —Ç–∞–±–ª–∏—Ü–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –∞ –∑–∞ –∫–æ–Ω–µ—Ü –∫–∞–∂–¥–æ–π –Ω–µ–¥–µ–ª–∏. –î–ª—è –∫–∞–∂–¥–æ–π –¥–∞—Ç—ã –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π, –æ—Ç–ª–∏—á–∞—é—â–∏—Ö—Å—è –ø–æ —Ç–∏–ø—É –∞–≤–æ–∫–∞–¥–æ –∏ —Ä–µ–≥–∏–æ–Ω—É –ø—Ä–æ–¥–∞–∂–∏. 
  ____________
*–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∞–≤–æ–∫–∞–¥–æ –≤ –¥–≤—É—Ö –≥–æ—Ä–æ–¥–∞—Ö (NewYork, LosAngeles) –∏ —É–∑–Ω–∞–µ–º, 
—Å–∫–æ–ª—å–∫–æ –∞–≤–æ–∫–∞–¥–æ —Ç–∏–ø–∞ organic –±—ã–ª–æ –ø—Ä–æ–¥–∞–Ω–æ –≤ —Ü–µ–ª–æ–º –∫ –∫–æ–Ω—Ü—É –∫–∞–∂–¥–æ–π –Ω–µ–¥–µ–ª–∏ (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂), 
–Ω–∞—á–∏–Ω–∞—è —Å –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π (04/01/15).
–ó–Ω–∞—á–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –æ–∫–Ω–∞ —Å–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ –¥–∞—Ç–µ, –∞ —Å–∞–º—É —Ç–∞–±–ª–∏—Ü—É –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Ä–µ–≥–∏–æ–Ω–∞ (—Å–Ω–∞—á–∞–ª–∞ NY, –ø–æ—Ç–æ–º LA) –∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –¥–∞—Ç—ã.
–í –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç–≤–µ—Ç–∞ —É–∫–∞–∂–∏—Ç–µ –æ–±—ä–µ–º –ø—Ä–æ–¥–∞–∂ –≤ –ù—å—é –ô–æ—Ä–∫–µ –Ω–∞ 01/03/15 (–±–µ–∑ –∑–∞–ø—è—Ç—ã—Ö).*
  
```sql
SELECT *
FROM 
    (
    SELECT 
        region,
        date,
        total_volume,
        sum(total_volume) OVER (PARTITION BY region
                                ORDER BY date
                                ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) volume
    FROM avocado
    WHERE region in ('NewYork', 'LosAngeles') 
                AND type = 'organic'
                AND date >= '01/04/15'::date

    ORDER BY region DESC, date
   ) as t
WHERE date = '03/01/15'::date
```
__________
*–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–±–∏–≤–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É –≥–æ–¥—É (year). –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤ –∫–æ–Ω—Ü–µ —Ñ–µ–≤—Ä–∞–ª—è 2016 –≥–æ–¥–∞ –æ–±—ä–µ–º —Å–æ—Å—Ç–∞–≤—è—Ç —É–∂–µ –Ω–µ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ 2015 –∏ —è–Ω–≤–∞—Ä—å-—Ñ–µ–≤—Ä–∞–ª—å 2016, –∞ —Ç–æ–ª—å–∫–æ –∑–∞ —è–Ω–≤–∞—Ä—å-—Ñ–µ–≤—Ä–∞–ª—å 2016.
–ö–æ–≥–¥–∞ –æ–±—ä–µ–º—ã –ø—Ä–æ–¥–∞–∂ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏—Ö –∞–≤–æ–∫–∞–¥–æ –≤ –ù—å—é-–ô–æ—Ä–∫–µ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –æ–±—ä–µ–º—ã –ø—Ä–æ–¥–∞–∂ –≤ –õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å–µ?*

```sql
SELECT
    region,    
    date,   
    total_volume,    
    SUM(total_volume) OVER w AS volume    
FROM
    avocado  
WHERE region in ('NewYork', 'LosAngeles')
      AND type = 'organic'
WINDOW w AS
    (    
    PARTITION BY region , year  
    ORDER BY date ASC   
    ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW   
    )
ORDER BY
    region DESC,    
    date ASC
```
__________
*–ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–æ–≥–¥–∞ –æ–±—ä–µ–º—ã –ø—Ä–æ–¥–∞–∂ –æ–±—ã—á–Ω—ã—Ö (conventional) –∞–≤–æ–∫–∞–¥–æ —Ä–µ–∑–∫–æ –ø–∞–¥–∞–ª–∏ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π. –í–æ–∑—å–º–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –°–®–ê –≤ —Ü–µ–ª–æ–º, –ø–æ—Å—á–∏—Ç–∞–π—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –æ–±—ä–µ–º–æ–º –ø—Ä–æ–¥–∞–∂ –≤ –Ω–µ–¥–µ–ª—é x (total_volume) –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∞–≤–æ–∫–∞–¥–æ –≤ —Ç–µ—á–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏. –ó–Ω–∞—á–µ–Ω–∏—è –∑–∞–ø–∏—à–∏—Ç–µ –≤ –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü week_diff.*

```sql
SELECT 
        date,
        total_volume,
        region,
        type,
        total_volume - lag(total_volume, 1) OVER (PARTITION BY region
                                                    ORDER BY date
                                                  ) week_diff
          
FROM avocado
WHERE type = 'conventional' AND region = 'TotalUS'
```
__________
*–ü–æ—Å–º–æ—Ç—Ä–∏–º –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –Ω–∞ –æ–±—ä–µ–º—ã –ø—Ä–æ–¥–∞–∂ –∞–≤–æ–∫–∞–¥–æ –≤ –ù—å—é-–ô–æ—Ä–∫–µ (NewYork) –≤ 2018 –≥–æ–¥—É. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–ª–æ–Ω–∫—É —Å —Ä–∞–∑–Ω–∏—Ü–µ–π –æ–±—ä–µ–º–æ–≤ –ø—Ä–æ–¥–∞–∂ –∑–∞ –Ω–µ–¥–µ–ª—é –∏ –∑–∞ –Ω–µ–¥–µ–ª—é –¥–æ —ç—Ç–æ–≥–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∞–≤–æ–∫–∞–¥–æ. –ù–∞–π–¥–∏—Ç–µ –¥–µ–Ω—å, –∫–æ–≥–¥–∞ –ø—Ä–æ–¥–∞–∂–∏ –∞–≤–æ–∫–∞–¥–æ —Ç–∏–ø–∞ organic —É–≤–µ–ª–∏—á–∏–ª–∏—Å—å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π, –∞ conventional ‚Äì –Ω–∞–æ–±–æ—Ä–æ—Ç —É–ø–∞–ª–∏. –ï—Å–ª–∏ —Ç–∞–∫–∏—Ö –¥–Ω–µ–π –Ω–µ—Å–∫–æ–ª—å–∫–æ, —Ç–æ —É–∫–∞–∂–∏—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é —Å –ø—Ä–æ–±–µ–ª–æ–º, —Ñ–æ—Ä–º–∞—Ç ‚Äì 31/12/2020.*

```sql
SELECT 
        date,
        year,
        total_volume,
        type,
        total_volume - lag(total_volume, 1) OVER (PARTITION BY type
                                                    ORDER BY date
                                                  ) week_diff
          
FROM avocado
WHERE region = 'NewYork' and year = 2018
ORDER BY type
```
__________
*–¢–µ–ø–µ—Ä—å –ø–æ—Å—á–∏—Ç–∞–π—Ç–µ —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ —Ü–µ–Ω—ã –∞–≤–æ–∫–∞–¥–æ (average_price) –≤ –ù—å—é-–ô–æ—Ä–∫–µ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ —Ç–∏–ø—É –∞–≤–æ–∫–∞–¥–æ. –í –∫–∞—á–µ—Å—Ç–≤–µ –æ–∫–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–≤–µ (–æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤ –¥–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –≤ —Å—Ç—Ä–æ–∫–∞—Ö —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é, –∞ –Ω–µ –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å). –ù–∞–ø—Ä–∏–º–µ—Ä 04/01/15, 11/01/15 –∏ 18/01/15 –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è 18/01/15.
–í –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç–≤–µ—Ç–∞ —É–∫–∞–∂–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö (conventional) –∞–≤–æ–∫–∞–¥–æ –∑–∞ 17/04/16.*

```sql
SELECT 
        date,
        average_price ,
        region,
        type,
        AVG(average_price) OVER (PARTITION BY type
                            ORDER BY date
                            ROWS BETWEEN 2 PRECEDING AND CURRENT ROW ) rolling_price 
          
FROM avocado
WHERE region = 'NewYork'  
--and date = '04/17/16'::date
ORDER BY date
```
__________
**

```sql

```
__________
